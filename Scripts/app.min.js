define("analytics",[],function(){var n=function(){},t=function(n,t){mixpanel.track(n,t)};return{identify:n,track:t}});define("assetManager",["createjs"],function(n){var f={},i,e=$.Callbacks(),o=$.Callbacks(),h=[{src:"./Content/Images/oryx_creatures.png",id:"creatures"},{src:"./Content/Images/bg.png",id:"bg"},{src:"./Content/Images/table.png",id:"table"},{src:"./Content/Images/cashier.png",id:"cashier"},{src:"./Content/Images/oryx_items.png",id:"items"},{src:"./Content/Images/heart.png",id:"heart"},{src:"./Content/Images/bag.png",id:"bag"},{src:"./Content/Images/robber.png",id:"robber"},{src:"./Content/Images/robberHeart.png",id:"robberHeart"},{src:"./Content/Images/logo.png",id:"logo"},{src:"./Content/Images/muted.png",id:"muted"},{src:"./Content/Images/unmuted.png",id:"unmuted"},{src:"./Content/Images/cash_register.png",id:"cashRegister"},{src:"./Content/Sounds/walk.mp3|./Content/Sounds/walk.ogg",id:"walk"},{src:"./Content/Sounds/bump.mp3|./Content/Sounds/bump.ogg",id:"bump"},{src:"./Content/Sounds/thud.mp3|./Content/Sounds/thud.ogg",id:"thud"},{src:"./Content/Sounds/beep.mp3|./Content/Sounds/beep.ogg",id:"beep"},{src:"./Content/Sounds/bossa.mp3|./Content/Sounds/bossa.ogg",id:"bossa"},{src:"./Content/Sounds/action.mp3|./Content/Sounds/action.ogg",id:"action"},{src:"./Content/Sounds/win.mp3|./Content/Sounds/win.ogg",id:"win"},],c=function(){i=new n.LoadQueue;i.installPlugin(n.Sound);i.addEventListener("complete",v);i.addEventListener("fileload",l);i.addEventListener("progress",a);i.loadManifest(h)},l=function(n){n.item.type==="image"&&(f[n.item.id]=n.result)},a=function(n){e.fireWith(window,[n.progress])},v=function(){o.fire()},t,r=!1,u=function(t,i,r){i=i||1;return n.Sound.play(t,n.Sound.INTERRUPT_NONE,0,0,r?-1:0,i)},s=function(i){n.Tween.get(t).to({volume:0},800,n.Ease.quadIn).call(function(){t.stop();i&&i()})},y=function(n,i){t?t.id!==n&&s(function(){t=u(n,i,!0);t.id=n}):(t=u(n,i,!0),t.id=n)},p=function(){r=!r;n.Sound.setMute(r)};return{loadAssets:c,progressChangedEvent:e,loadCompleteEvent:o,images:f,playSound:u,toggleMute:p,playMusic:y,stopMusic:s,isMuted:function(){return r}}});define("BaseEntity",["createjs"],function(){return Class.extend({init:function(n,t){this.setSize();this.createSpriteSheet();this.createView(n,t)},createSpriteSheet:function(){},createView:function(){},setSize:function(){this.size={w:0,h:0}},getBounds:function(){return{x:this.view.x,y:this.view.y,width:this.size.w,height:this.size.h}}})});define("bootstrapper",["gameManager","analytics"],function(n,t){var i=function(){t.track("Page View");Math.sign=function(n){return n?n<0?-1:1:0};r()},r=function(){n.init()};return{run:i}}),function(n){function i(){define("createjs",[],function(){return t.createjs})}function r(){requirejs([],u)}function u(){require(["bootstrapper"],function(t){t.run(n)})}var t=this;require.config({baseUrl:"/Scripts/app"});i();r()}(document);define("CashierEntity",["createjs","CreatureEntity","text","constants","assetManager","NpcEntity"],function(n,t,i,r,u,f){return f.extend({init:function(n,t){this.name=i.getCashierName(9);this.score=Math.round(Math.random()*2+14);this.accuracy=Math.round(Math.random()*5+5);this.speed=this.score-this.accuracy;this.timeToScan=r.BASE_SCANE_TIME*(1+(10-this.speed)/10);this._super(n,t)},createSpriteSheet:function(){var t=Math.random()*.04+.06,i={images:[u.images.cashier],frames:{width:this.size.w,height:this.size.h},animations:{idle:{frames:[0,1],speed:t}}};this.spriteSheet=new n.SpriteSheet(i)},showDescription:function(){this.description.alpha===0&&n.Tween.get(this.description).to({alpha:1},100,n.Ease.quadIn)},hideDescription:function(){this.description.alpha===1&&n.Tween.get(this.description).to({alpha:0},100,n.Ease.quadIn)},toggleDescription:function(){this.description.alpha===1?this.hideDescription():this.description.alpha===0&&this.showDescription()},createView:function(t,i){var u,f,e,o,s;this._super(t,i);this.description=new n.Container;this.description.x=this.size.w+5;this.description.y=5;this.description.alpha=0;u=new n.Shape;u.graphics.beginFill("gray").drawRoundRect(0,0,r.TILE_SIZE*1.75,r.TILE_SIZE*1.75,5).beginFill("black").drawRoundRect(2,2,r.TILE_SIZE*1.75-4,r.TILE_SIZE*1.75-4,5);u.alpha=.8;f=new n.Text(this.name,"10px "+r.FONT+" ","white");f.x=6;f.y=6;e=new n.Text("Speed: "+this.speed,"9px "+r.FONT,"white");e.x=6;e.y=30;o=new n.Text("Accuracy: "+this.accuracy,"9px "+r.FONT,"white");o.x=6;o.y=54;this.description.addChild(u,f,o,e);s=this;this.avatar.addEventListener("mouseover",function(){s.showDescription()});this.avatar.addEventListener("mouseout",function(){s.hideDescription()});this.view.addChild(this.description);this.view.mouseEnabled=!0;this.itemCountLabel.alpha=0}})});define("constants",[],function(){return{WORLD_WIDTH:720,WORLD_HEIGHT:528,NUM_ROWS:11,NUM_COLUMNS:15,FPS:30,GRAVITY:2,MOVE_SPEED:10,CHANCE_OF_NEW_NPC:.5,MAX_CREATURES_IN_QUEUE:7,CHANCE_OF_BEING_AGRESSIVE:1,NUM_OF_WARNINGS_BEFORE_ENGAGING:1,ENTRY_ROWS:[1,3,5,7,9],CORNERS:[{row:1,col:13},{row:9,col:13},{row:1,col:0},{row:9,col:0}],CREATURES_IN_ROW:18,CREATURES_IN_COLUMN:11,TILE_SIZE:48,FONT:"Minecraftia",BASE_SCANE_TIME:800,MIN_MOVEMENT_SPEED:400,MAX_MOVEMENT_SPEED:900,TIME_TO_MAYBE_ADD_NPC_TO_QUEUE:4e3,TIME_BETWEEN_CALLS_TO_MOVE_UP:5e3,TIME_BETWEEN_WARNINGS:2200,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_UP:38,KEY_LEFT:37,KEY_RIGHT:39,KEY_DOWN:40,KEY_SPACE:32,KEY_LCTRL:17,KEY_ENTER:13,KEY_ESC:27}});define("CopEntity",["createjs","NpcEntity","tileManager","assetManager"],function(n,t){return t.extend({init:function(n,t,i,r){var u=this;this._super(n,t,36);this.itemCountLabel.alpha=0;this.killMode=!0;this.shouldMove=!0;this.isCop=!0;this.movementDestination={row:i.row,col:i.col};r&&this.say("Stop in the name of the law!");i.moved.add(function(){u.movementDestination={row:i.row,col:i.col}});this.hitPoints=3}})});define("CreatureEntity",["createjs","assetManager","BaseEntity","utils","constants","tileManager"],function(n,t,i,r,u,f){return i.extend({init:function(n,t,i){var e,u;this.setItemCount();e=this.getRandomCreatureIndex();this.creatureIndex=i===undefined?e:i;u=r.getAbsolutePositionByGridPosition(n,t);this.row=n;this.col=t;this.hitPoints=3;this.isDead=!1;this._super(u.x,u.y);f.collisionMap[this.row][this.col]=this;this.moved=$.Callbacks();this.tookHit=$.Callbacks();this.died=$.Callbacks();this.sayingSomething=$.Callbacks()},getRandomCreatureIndex:function(){var n=0,t,i;do t=Math.floor(Math.random()*u.CREATURES_IN_COLUMN),i=Math.floor(Math.random()*u.CREATURES_IN_ROW),n=t*u.CREATURES_IN_ROW*2+i;while(n===0||n===36||n===86||n===124);return n},hit:function(){this.hitPoints--;this.tookHit.fire()},setItemCount:function(){this.initialItemCount=this.itemCount=0},setSize:function(){this.size={w:48,h:48}},createSpriteSheet:function(){var i=Math.random()*.04+.06,r={images:[t.images.creatures],frames:{width:this.size.w,height:this.size.h},animations:{idle:{frames:[this.creatureIndex,this.creatureIndex+u.CREATURES_IN_ROW],speed:i},scared:{frames:[this.creatureIndex,this.creatureIndex+u.CREATURES_IN_ROW],speed:.3},still:{frames:[this.creatureIndex],speed:.3}}};this.spriteSheet=new n.SpriteSheet(r)},createView:function(t,i){this.view=new n.Container;this.createSpeechBubble(u.TILE_SIZE*1.5,u.TILE_SIZE,-u.TILE_SIZE/2,"10px",12);this.avatar=new n.Sprite(this.spriteSheet,"idle");this.avatar.regX=this.avatar.regY=this.size.w/2;this.avatar.x=this.avatar.y=this.size.w/2;this.view.addChild(this.avatar);this.view.x=t;this.view.y=i;this.itemCountLabel=new n.Container;this.itemCountLabel.x=this.size.w-5;this.itemCountLabel.y=this.size.h-5;var r=new n.Shape;r.graphics.beginFill("gray").drawCircle(0,0,11).beginFill("black").drawCircle(0,0,9);r.alpha=.7;this.itemCountText=new n.Text(this.itemCount.toString(),"14px Arial","white");this.itemCountText.x=-4;this.itemCountText.y=-8;this.firstInLine=!1;this.itemCountLabel.addChild(r,this.itemCountText);this.view.addChild(this.itemCountLabel)},createSpeechBubble:function(t,i,r,f,e){this.speechBubble&&this.view.removeChild(this.speechBubble);this.speechBubbleText=new n.Text(this.name,f+" "+u.FONT+"","white");this.speechBubbleText.lineWidth=t-10;this.speechBubbleText.x=6;this.speechBubbleText.y=2;this.speechBubbleText.lineHeight=e;this.speechBubbleWidth=t;this.speechBubble=new n.Container;this.speechBubbleContainer=new n.Shape;this.drawBubbleAndSetY(t,i);this.speechBubble.alpha=0;this.speechBubble.x=r;this.speechBubble.addChild(this.speechBubbleContainer,this.speechBubbleText);this.view.addChild(this.speechBubble)},drawBubbleAndSetY:function(){var n=this.speechBubbleText.getMeasuredHeight()+10;this.speechBubbleContainer.graphics.clear().beginFill("gray").drawRoundRect(0,0,this.speechBubbleWidth,n,5).beginFill("black").drawRoundRect(2,2,this.speechBubbleWidth-4,n-4,5);this.speechBubble.y=-n},tick:function(){},setPosition:function(n,t){f.collisionMap[this.row][this.col]=!1;f.collisionMap[n][t]=this;this.row=n;this.col=t;var i=r.getAbsolutePositionByGridPosition(n,t);this.view.x=i.x;this.view.y=i.y},say:function(t,i,r,u){if(!this.isDead){this.speechBubbleText.text=t;this.drawBubbleAndSetY();u||f.collisionMap[this.row-1][this.col]&&!f.collisionMap[this.row+1][this.col]&&(this.speechBubble.y=this.speechBubble.y*-1);i=i||3e3;var e=this;n.Tween.get(this.speechBubble).to({alpha:1},100,n.Ease.quadIn).call(function(){e.isDead?n.Tween.get(e.speechBubble).to({alpha:0},100,n.Ease.quadIn):e.sayingSomething.fire(e)});this.speechTimeout&&clearInterval(this.speechTimeout);this.dialogCallback=r;this.speechTimeout=setTimeout(function(){e.endDialog.apply(e)},i)}},endDialog:function(){var t=this,i=this.dialogCallback;t.dialogCallback=null;n.Tween.get(this.speechBubble).to({alpha:0},100,n.Ease.quadIn);i&&setTimeout(function(){i(t)},100)},stopSayingSomething:function(){this.speechTimeout&&clearInterval(this.speechTimeout);this.endDialog()},removeItem:function(){this.itemCount>0&&(this.itemCount--,this.itemCountText.text=this.itemCount)},showItemCount:function(){this.itemCountLabel.alpha===0&&n.Tween.get(this.itemCountLabel).to({alpha:1},100,n.Ease.quadIn)},hideItemCount:function(){this.itemCountLabel.alpha===1&&n.Tween.get(this.itemCountLabel).to({alpha:0},200,n.Ease.quadIn)},toggleItemCountLabel:function(){this.itemCountLabel.alpha===1?this.hideItemCount():this.itemCountLabel.alpha===0&&this.showItemCount()},die:function(t){var i=this;this.isDead=!0;n.Tween.get(this.avatar).to({rotation:720},1e3,n.Ease.quadOut).call(function(){});n.Tween.get(this.avatar).to({alpha:0},1e3,n.Ease.quadIn).call(function(){});n.Tween.get(this.avatar).to({scaleX:0},1e3,n.Ease.quadOut).call(function(){});n.Tween.get(this.avatar).to({scaleY:0},1e3,n.Ease.quadOut).call(function(){});f.collisionMap[i.row][i.col]=!1;setTimeout(function(){i.died.fire(i);t&&t()},500)}})});define("CreditsScreen",["MenuScreen","assetManager","constants"],function(n,t){return n.extend({init:function(){this._super();var n=this;this.title=this.createOutlinedText("All programming and music by Inja Games",18,50,2);this.logo=new createjs.Bitmap(t.images.logo);this.logo.y=80;this.logo.x=230;this.subItem1=this.createOutlinedText("• Using the 16-bit set from Oryx Design Labs",18,310,2);this.subItem2=this.createOutlinedText("www.oryxdesignlab.com",14,332,2);this.subItem3=this.createOutlinedText("• Created with CreateJS",18,370,2);this.subItem4=this.createOutlinedText("Subscribe to our twitter feed for more news!",18,410,2);this.subItem5=this.createOutlinedText("twitter.com/InjaGames",18,440,2);this.mainView.addChild(this.title,this.logo,this.subItem1,this.subItem2,this.subItem3,this.subItem4,this.subItem5);this.setupLink(this.subItem2,"http://www.oryxdesignlab.com");this.setupLink(this.subItem5,"http://twitter.com/InjaGames");this.mainView.addEventListener("click",function(t){n.subItem2.hitTest(n.subItem2.globalToLocal(t.stageX,t.stageY).x,n.subItem2.globalToLocal(t.stageX,t.stageY).y)||n.subItem7.hitTest(n.subItem2.globalToLocal(t.stageX,t.stageY).x,n.subItem7.globalToLocal(t.stageX,t.stageY).y)||n.goToMainMenuScreen.fire()})},activate:function(){},handleKeyDown:function(){this.goToMainMenuScreen.fire()},setupLink:function(n,t){var i=n;n.addEventListener("mouseover",function(){i.main.color="lightblue"});n.addEventListener("mouseout",function(){i.main.color="white"});n.addEventListener("click",function(){window.open(t,"_blank")})}})});define("gameManager",["createjs","assetManager","CreatureEntity","constants","Queue","tileManager","screenManager"],function(n,t,i,r,u,f,e){var h,l,a,o,s,v=function(){l=$("#game-canvas").width();a=$("#game-canvas").height();h=new n.Stage("game-canvas");h.enableMouseOver(10);n.Ticker.requestRAF=!0;n.Ticker.setFPS(r.FPS);n.Ticker.addEventListener("tick",k);e.loadSplash(function(){y()});h.addChild(e.splashScreen().mainView)},y=function(){e.init();for(var i=0;i<e.screens.length;i++)h.addChild(e.screens[i].mainView);o=new n.Bitmap(t.images.muted);o.x=20;o.y=r.WORLD_HEIGHT-38;o.scaleX=o.scaleY=.5;o.alpha=0;s=new n.Bitmap(t.images.unmuted);s.x=20;s.y=r.WORLD_HEIGHT-38;s.scaleX=s.scaleY=.5;s.alpha=0;h.addChild(o,s);p();e.getCurrentScreen().activate();e.getCurrentScreen().show()},p=function(){document.onkeydown=w;document.onkeyup=b},c={},w=function(i){if(!c[i.keyCode]&&(c[i.keyCode]=!0,e.getCurrentScreen().handleKeyDown(i),i.keyCode===r.KEY_M)){var u=t.isMuted()?s:o;n.Tween.get(u).to({alpha:1},200,n.Ease.quadIn);setTimeout(function(){n.Tween.get(u).to({alpha:0},400,n.Ease.quadIn)},1e3);t.toggleMute()}},b=function(n){c[n.keyCode]=!1;e.getCurrentScreen().handleKeyUp(n)},k=function(n){e.getCurrentScreen()&&e.getCurrentScreen().tick(n);h.update()};return{init:v}});define("GameScreen",["createjs","Screen","PlayerEntity","Queue","assetManager","constants","tileManager","CopEntity","utils","RobberEntity","text","analytics"],function(n,t,i,r,u,f,e,o,s,h,c,l){return t.extend({init:function(t,i,r){var e=this,p,v,y,o;for(this.currentLevel=t||0,l.track("Started Level "+this.currentLevel),this.endGameRetries=i||0,r||this._super(),this.gameWorld=new n.Container,this.mainView.addChild(this.gameWorld),this.isInEndGame=!1,this.endStateText=this.createOutlinedText("",36,0,4),this.endStateText.setLineWidth(f.WORLD_WIDTH-100),this.endStateText.setLineHeight(39),this.winStateText=this.createOutlinedText("",20,0,2),this.winStateText.setLineHeight(23),this.winStateText.setLineWidth(f.WORLD_WIDTH-100),this.winStateText.alpha=0,this.pressAnyKeyText=this.createOutlinedText("press any key",12,0,2),this.endStateContainer=new n.Container,this.endStateContainer.alpha=0,this.endStateContainer.addChild(this.endStateText,this.winStateText,this.pressAnyKeyText),this.mainView.addChild(this.endStateContainer),p=new n.Bitmap(u.images.bg),this.gameWorld.addChild(p),this.setupLevel(),this.cops=[],this.gameWorld.addChild(this.player.view),this.inWinState=!1,this.inLoseState=!1,this.player.winState.add(function(){e.inWinState=!0;e.showEndState.apply(e,[c.getRandomText(c.checkedOutTexts)])}),this.player.loseState.add(function(n){e.inLoseState=!0;e.showEndState.apply(e,[n])}),v=10,this.hitPointsIcons=[],y=0;y<this.player.hitPoints;y++)o=new n.Bitmap(u.images.heart),o.x=v,o.y=6,this.hitPointsIcons.push(o),this.gameWorld.addChild(o),v+=36;this.player.tookHit.add(function(){e.gameWorld.removeChild(e.hitPointsIcons[e.hitPointsIcons.length-1]);e.hitPointsIcons.splice(e.hitPointsIcons.length-1,1)});this.timeSinceLevelStart=0;this.timeLabel=new n.Text("00:00","25px "+f.FONT,"#0BF50B");this.timeLabel.x=f.WORLD_WIDTH-90;this.timeLabel.y=-2;this.gameWorld.addChild(this.timeLabel);this.bag=new n.Bitmap(u.images.bag);this.bag.x=185;this.bag.y=4;this.itemCountLabel=new n.Text(this.player.itemCount,"25px "+f.FONT,"white");this.itemCountLabel.x=140;this.itemCountLabel.y=0;this.gameWorld.addChild(this.bag,this.itemCountLabel);this.setupEndgame();this.isInEndgameCutscene=!1;this.npcInDialog=null;this.paused=!1;this.pauseMenu=new n.Container;this.pauseMenu.setBounds(0,0,f.WORLD_WIDTH,f.WORLD_HEIGHT);this.levelTitle=this.createOutlinedText("Level "+(this.currentLevel+1),30,100,3);var s=this.createOutlinedText("Continue shopping",18,210,2,this.highlightedColor),h=this.createOutlinedText("Reset Campaign",18,250,2),a=this.createOutlinedText("Back to main menu",18,290,2);this.pauseMenu.addChild(this.levelTitle,s,h,a);this.pauseMenu.alpha=0;this.pauseMenuSelectedItem=1;this.mainView.addChild(this.pauseMenu);s.addEventListener("mouseover",function(){for(var n=1;n<e.pauseMenu.children.length;n++)e.pauseMenu.children[n].main.color=e.pauseMenu.children[n]===s?e.highlightedColor:e.unHighlightedColor;e.currentHighlightedItem=0});s.addEventListener("click",function(){e.togglePause()});h.addEventListener("mouseover",function(){for(var n=1;n<e.pauseMenu.children.length;n++)e.pauseMenu.children[n].main.color=e.pauseMenu.children[n]===h?e.highlightedColor:e.unHighlightedColor;e.currentHighlightedItem=0});h.addEventListener("click",function(){e.reset(!0)});a.addEventListener("mouseover",function(){for(var n=1;n<e.pauseMenu.children.length;n++)e.pauseMenu.children[n].main.color=e.pauseMenu.children[n]===a?e.highlightedColor:e.unHighlightedColor;e.currentHighlightedItem=0});a.addEventListener("click",function(){e.goToMainMenuScreen.fire();setTimeout(function(){e.pauseMenu.alpha=0;e.gameWorld.alpha=1},500)})},togglePause:function(){this.paused=!this.paused;n.Tween.get(this.gameWorld).to({alpha:this.paused?.2:1},200,n.Ease.quadIn);n.Tween.get(this.pauseMenu).to({alpha:this.paused?1:0},200,n.Ease.quadIn)},setupLevel:function(){var r=this,n=window.levels[this.currentLevel],t;for(this.player=new i(n.entryRow,0),this.currentLevelTimes=n.times,this.player.itemCount=n.itemCount,this.queues=[],t=0;t<n.queues.length;t++)this.createQueue(n.queues[t]);this.currentLevel===window.levels.length-1&&this.player.moved.add(function u(){r.player.col===3&&(r.player.moved.remove(u),r.activateEndGame())})},createQueue:function(n){for(var t,i=new r(this.player,n[0],n[1],n[2],n[3],n[4],n[5]),e=i.getViews(),u=0;u<e.length;u++)this.gameWorld.addChild(e[u]);t=this;i.viewAdded.add(function(n){t.gameWorld.removeChild(t.player.view);t.gameWorld.addChild(n);t.gameWorld.addChild(t.player.view)});i.viewRemoved.add(function(n){t.gameWorld.removeChild(n)});i.npcDied.add(function(){var r=new o(n[5],f.NUM_COLUMNS-1,t.player,t.cops.length==0),i;t.cops.push(r);i=new o(n[4],0,t.player,t.cops.length==0);t.cops.push(i);t.gameWorld.addChild(r.view,i.view)});this.queues.push(i)},showEndState:function(t){this.endStateText.setText(t);var i=this.endStateText.main.getMeasuredHeight();this.endStateText.y=f.WORLD_HEIGHT/2-i*2/3;this.inWinState?(this.winStateText.alpha=1,this.winStateText.y=this.endStateText.y+i+10,this.winStateText.setText(this.getWinStateText()),this.pressAnyKeyText.y=this.winStateText.y+this.winStateText.main.getMeasuredHeight()+20):(this.winStateText.alpha=0,this.pressAnyKeyText.y=this.endStateText.y+i+20);n.Tween.get(this.gameWorld).to({alpha:.2},200,n.Ease.quadIn);n.Tween.get(this.endStateContainer).to({alpha:1},200,n.Ease.quadIn)},getWinStateText:function(){var n=this.timeSinceLevelStart,t="You checked out in "+s.getTimespanInText(n)+"! ";return t+(n/1e3<this.currentLevelTimes[0]?c.getRandomText(c.checkedOutFastTexts):n/1e3<this.currentLevelTimes[1]?c.getRandomText(c.checkedOutMiddleTexts):c.getRandomText(c.checkedOutSlowTexts))},handleKeyDown:function(n){var i=this,t;if((n.keyCode===f.KEY_SPACE||n.keyCode===f.KEY_ENTER)&&this.npcInDialog&&this.npcInDialog.stopSayingSomething(),(n.keyCode===f.KEY_P||n.keyCode===f.KEY_ESC)&&this.togglePause(),(this.inWinState||this.inLoseState)&&(this.currentLevel+=this.inWinState?1:0,this.reset()),this.paused){if(n.keyCode===f.KEY_S||n.keyCode===f.KEY_DOWN){for(t=1;t<this.pauseMenu.children.length;t++)this.pauseMenu.children[t].main.color=this.unHighlightedColor;this.pauseMenuSelectedItem++;this.pauseMenuSelectedItem==this.pauseMenu.children.length&&(this.pauseMenuSelectedItem=1);this.pauseMenu.children[this.pauseMenuSelectedItem].main.color=this.highlightedColor}else if(n.keyCode===f.KEY_W||n.keyCode===f.KEY_UP){for(t=1;t<this.pauseMenu.children.length;t++)this.pauseMenu.children[t].main.color=this.unHighlightedColor;this.pauseMenuSelectedItem--;this.pauseMenuSelectedItem==0&&(this.pauseMenuSelectedItem=this.pauseMenu.children.length-1);this.pauseMenu.children[this.pauseMenuSelectedItem].main.color=this.highlightedColor}(n.keyCode===f.KEY_SPACE||n.keyCode===f.KEY_ENTER)&&(this.pauseMenuSelectedItem===1&&this.togglePause(),this.pauseMenuSelectedItem===2?this.reset():this.pauseMenuSelectedItem===3&&(this.goToMainMenuScreen.fire(),setTimeout(function(){i.pauseMenu.alpha=0;i.gameWorld.alpha=1},500)))}else{if(this.isInEndgameCutscene)return;n.keyCode===f.KEY_S||n.keyCode===f.KEY_DOWN?this.player.move(0,1):n.keyCode===f.KEY_A||n.keyCode===f.KEY_LEFT?this.player.move(-1,0):n.keyCode===f.KEY_W||n.keyCode===f.KEY_UP?this.player.move(0,-1):(n.keyCode===f.KEY_D||n.keyCode===f.KEY_RIGHT)&&this.player.move(1,0)}},handleKeyUp:function(){},activate:function(){this.currentLevel=0;u.playMusic("bossa",.2);this.needsReset&&this.reset();this.paused=!1},tick:function(n){var t,i;if(!this.inWinState&&!this.inLoseState&&!this.paused){for(t=0;t<this.queues.length;t++)this.queues[t].tick(n);for(i=0;i<this.cops.length;i++)this.cops[i].tick(n);this.robber&&this.robber.tick(n);this.timeSinceLevelStart+=n.delta;this.timeLabel.text=s.msToReadableTime(this.timeSinceLevelStart);this.timeSinceLevelStart>this.currentLevelTimes[1]*1e3?this.timeLabel.color="red":this.timeSinceLevelStart>this.currentLevelTimes[0]*1e3&&(this.timeLabel.color="orange");this.itemCountLabel.text=this.player.itemCount}},reset:function(n){var t=this,i=n?0:t.currentLevel;this.hide(function(){t.mainView.removeAllChildren();e.clearCollisionMap();t.init.apply(t,[i,t.endGameRetries+(t.inLoseState&&t.isInEndGame?1:0),!0]);t.show()})},setupEndgame:function(){this.zoomIteration=0;this.movieBlocks=new n.Shape;this.movieBlocks.alpha=0;this.movieBlocks.graphics.beginFill("black").drawRect(0,0,f.WORLD_WIDTH,f.TILE_SIZE).drawRect(0,f.WORLD_HEIGHT-f.TILE_SIZE,f.WORLD_WIDTH,f.TILE_SIZE);this.gameWorld.addChild(this.movieBlocks)},activateEndGame:function(){var t,i;for(l.track("Reached Endgame"),u.stopMusic(),t=this,t.isInEndgameCutscene=!0,t.isInEndGame=!0,n.Tween.get(this.movieBlocks).to({alpha:1},500,n.Ease.quadIn),i=0;i<t.queues.length;i++)t.queues[i].pauseNpcs=!0,t.queues[i].isInEndgame=!0;setTimeout(function(){var o,s,l,i,r;for(u.playMusic("action",.5),t.robber=new h,t.robberHitPointsIcons=new n.Container,t.robberHitPointsIcons.x=386,t.robberHitPointsIcons.y=f.WORLD_HEIGHT-42,t.robberHitPointsIcons.alpha=0,o=0,s=0;s<t.robber.hitPoints;s++)l=new n.Bitmap(u.images.robberHeart),l.x=o,t.robberHitPointsIcons.addChild(l),o+=36;t.gameWorld.addChild(t.robberHitPointsIcons);t.robber.sayingSomething.add(function(n){t.npcInDialog=n});t.robber.tookHit.add(function(){t.gameWorld.removeChild(t.robberHitPointsIcons[t.robberHitPointsIcons.length-1]);t.robberHitPointsIcons.removeChildAt(0)});t.gameWorld.addChild(t.robber.view);i=5;r=13;e.collisionMap[i][r]&&(i=6,e.collisionMap[i][r]&&(i=4,e.collisionMap[i][r]&&(i=5,r=12,t.robber.ignoreNpcsWhenMoving=!0)));t.robber.movementDestination={row:i,col:r};t.robber.shouldMove=!0;t.robber.finishedMoving.add(function a(){t.robber.say(c.getRobberText(c.robber.enterTexts,t.endGameRetries),5e3,function(){for(var r,e,o,u,i=0,n=0;n<t.queues.length;n++)for(t.queues[n].pauseNpcs=!1,r=0;r<t.queues[n].allNpcs.length;r++)e=t.queues[n].allNpcs[r],t.moveNpcOffScreen(e,i,t),i++;for(n=0;n<t.cops.length;n++)o=t.cops[n],t.moveNpcOffScreen(o,i,t),i++;for(t.endgameNpcsOnScreenCount=i,n=0;n<t.queues.length;n++)u=t.queues[n].cashier,u.avatar.gotoAndPlay("scared"),u.movementDestination=f.CORNERS[n],u.shouldMove=!0});t.robber.finishedMoving.remove(a);setTimeout(function(){t.robber.movementDestination={row:5,col:9};t.robber.shouldMove=!0;t.robber.finishedMoving.add(function n(){t.robber.finishedMoving.remove(n);t.continueEndGameWithRobber.apply(t)})},7e3)});t.timeLabel.alpha=0;t.bag.alpha=0;t.itemCountLabel.alpha=0},3e3)},moveNpcOffScreen:function(n,t,i){n.avatar.gotoAndPlay("scared");n.ignorePlayerWhenMoving=!0;n.movementSpeed=2*n.movementSpeed/3;n.movementDestination={row:f.ENTRY_ROWS[t%f.ENTRY_ROWS.length],col:-1};n.finishedMoving.add(function(n){i.gameWorld.removeChild(n.view);e.collisionMap[n.row][n.col]=!1;i.endgameNpcsOnScreenCount--});n.shouldMove=!0},continueEndGameWithRobber:function(){var t=this;this.robber.say(c.getRobberText(c.robber.afterEveryoneLeaves,t.endGameRetries)[0],5e3,function(){t.robber.say(c.getRobberText(c.robber.afterEveryoneLeaves,t.endGameRetries)[1],6e3,function(){t.robber.say(c.getRobberText(c.robber.afterEveryoneLeaves,t.endGameRetries)[2],6e3,function(){n.Tween.get(t.movieBlocks).to({alpha:0},500,n.Ease.quadIn).call(function(){t.isInEndgameCutscene=!1;var i=0;t.player.moved.add(function r(){if(i++,i<4){t.isInEndgameCutscene=!0;var u="";u=i===1?c.getRobberText(c.robber.provoked,t.endGameRetries)[0]:i===2?c.getRobberText(c.robber.provoked,t.endGameRetries)[1]:c.getRobberText(c.robber.provoked,t.endGameRetries)[2];n.Tween.get(t.movieBlocks).to({alpha:1},500,n.Ease.quadIn);t.robber.say(u,3e3,function(){n.Tween.get(t.movieBlocks).to({alpha:0},500,n.Ease.quadIn);t.isInEndgameCutscene=!1;i===3&&(t.player.moved.remove(r),n.Tween.get(t.robberHitPointsIcons).to({alpha:1},300,n.Ease.quadIn),t.startBossFight.apply(t))})}})})})})})},startBossFight:function(){var t=this;this.robber.kill(this.player);this.robber.died.add(function(){u.playMusic("win",.3);n.Tween.get(t.movieBlocks).to({alpha:1},500,n.Ease.quadIn);t.isInEndgameCutscene=!0;var i=t.player.row>5?t.queues[1].cashier:t.queues[0].cashier;i.movementDestination={row:t.player.row,col:t.player.col>=13?t.player.col-1:t.player.col+1};i.shouldMove=!0;i.createSpeechBubble(f.TILE_SIZE*2,f.TILE_SIZE*2,-f.TILE_SIZE/2,"13px",15);t.gameWorld.removeChild(i.view);t.gameWorld.addChild(i.view);i.sayingSomething.add(function(n){t.npcInDialog=n});i.finishedMoving.add(function(){t.cashierEndDialog.apply(t,[i,0])})})},cashierEndDialog:function(n,t){var i=this;n.say(c.cashierEndTexts[t],3e3,function(){t++;t<c.cashierEndTexts.length?(i.cashierEndDialog.apply(i,[n,t]),t==c.cashierEndTexts.length-1&&u.stopMusic()):i.zoomInterval=setInterval(function(){i.endZoomIn.apply(i)},1e3)},!0)},endZoomIn:function(){var n=this;u.playSound("thud");this.zoomIteration===6&&(clearInterval(this.zoomInterval),this.gameWorld.alpha=0,setTimeout(function(){n.needsReset=!0;n.goToMainMenuScreen.fire();l.track("Finished Game")},1e3));this.zoomIteration===0&&this.player.avatar.gotoAndPlay("still");this.gameWorld.regX=this.getZoomRegX(this.zoomIteration);this.gameWorld.regY=this.getZoomRegY(this.zoomIteration);this.gameWorld.scaleX=this.gameWorld.scaleY=this.gameWorld.scaleY*2;this.zoomIteration++},getZoomRegY:function(n){return n===0?this.player.view.y-110:n===1?this.player.view.y-45:n===2?this.player.view.y-13:n===3?this.player.view.y+3:n===4?this.player.view.y+12:n===5?this.player.view.y+15:void 0},getZoomRegX:function(n){return n===0?this.player.view.x-160:n===1?this.player.view.x-70:n===2?this.player.view.x-23:n===3?this.player.view.x+1:n===4?this.player.view.x+13:n===5?this.player.view.x+19:void 0}})});define("InstructionsScreen",["MenuScreen","createjs"],function(n){return n.extend({init:function(){this._super();var n=this;this.goal=this.createOutlinedText("Have the cashier scan all of your items to check out!",18,130,2);this.subItem1=this.createOutlinedText("• Stand in line (or don't)",18,200,2);this.subItem2=this.createOutlinedText("• Be nice to others (or don't)",18,230,2);this.subItem3=this.createOutlinedText("• Be a hero",18,260,2);this.subItem4=this.createOutlinedText("• Arrow/WASD keys to move",18,290,2);this.subItem5=this.createOutlinedText("• Space/Enter to skip dialog",18,320,2);this.subItem6=this.createOutlinedText("• P to pause, M to mute",18,350,2);this.subItem7=this.createOutlinedText("• Mouse over cashiers to see their stats",18,380,2);this.mainView.addChild(this.goal,this.subItem1,this.subItem2,this.subItem3,this.subItem4,this.subItem5,this.subItem6,this.subItem7,this.subItem8);this.mainView.addEventListener("click",function(){n.goToMainMenuScreen.fire()})},handleKeyDown:function(){this.goToMainMenuScreen.fire()}})});define("MainMenuScreen",["MenuScreen","createjs","constants","assetManager"],function(n,t,i,r){return n.extend({init:function(){var n;this._super();n=this;this.menuItems=[];this.currentHighlightedItem=0;this.title=this.createOutlinedText("Super Fantasy Queue",40,i.WORLD_HEIGHT/2,4);this.playCampaignItem=this.createOutlinedText("Campaign",18,230,2,this.highlightedColor);this.playCampaignItem.alpha=0;this.menuItems.push(this.playCampaignItem);this.playEndlessModeItem=this.createOutlinedText("Endless mode (coming soon)",18,270,2,"gray","black");this.playEndlessModeItem.alpha=0;this.menuItems.push(this.playEndlessModeItem);this.instructionsItem=this.createOutlinedText("How to play",18,310,2);this.instructionsItem.alpha=0;this.menuItems.push(this.instructionsItem);this.creditsItem=this.createOutlinedText("Credits",18,350,2);this.creditsItem.alpha=0;this.menuItems.push(this.creditsItem);this.finishedEntrance=!1;this.mainView.addChild(this.title,this.playCampaignItem,this.playEndlessModeItem,this.instructionsItem,this.creditsItem);this.setupMouseInteraction();n=this;setTimeout(function(){t.Tween.get(n.title).to({y:120},1e3,t.Ease.backInOut).call(function(){for(var i=0;i<n.menuItems.length;i++)t.Tween.get(n.menuItems[i]).to({alpha:1},500,t.Ease.quadIn),setTimeout(function(){n.finishedEntrance=!0},500)})},1e3)},activate:function(){r.playMusic("bossa",.2)},setupMouseInteraction:function(){var n=this;this.playCampaignItem.addEventListener("mouseover",function(){for(var t=0;t<n.menuItems.length;t++)t!=1&&(n.menuItems[t].main.color=n.menuItems[t]===n.playCampaignItem?n.highlightedColor:n.unHighlightedColor);n.currentHighlightedItem=0});this.playCampaignItem.addEventListener("click",function(){n.goToGameScreen.fire()});this.instructionsItem.addEventListener("mouseover",function(){for(var t=0;t<n.menuItems.length;t++)t!=1&&(n.menuItems[t].main.color=n.menuItems[t]===n.instructionsItem?n.highlightedColor:n.unHighlightedColor);n.currentHighlightedItem=2});this.instructionsItem.addEventListener("click",function(){n.goToInstructionsScreen.fire()});this.creditsItem.addEventListener("mouseover",function(){for(var t=0;t<n.menuItems.length;t++)t!=1&&(n.menuItems[t].main.color=n.menuItems[t]===n.creditsItem?n.highlightedColor:n.unHighlightedColor);n.currentHighlightedItem=3});this.creditsItem.addEventListener("click",function(){n.goToCreditsScreen.fire()})},handleKeyDown:function(n){this.finishedEntrance&&(n.keyCode===i.KEY_S||n.keyCode===i.KEY_DOWN?this.moveOneItemDown():(n.keyCode===i.KEY_W||n.keyCode===i.KEY_UP)&&this.moveOneItemUp(),(n.keyCode==i.KEY_SPACE||n.keyCode==i.KEY_ENTER)&&(this.currentHighlightedItem==0?this.goToGameScreen.fire():this.currentHighlightedItem==2?this.goToInstructionsScreen.fire():this.currentHighlightedItem==3&&this.goToCreditsScreen.fire()))},handleKeyUp:function(){},moveOneItemDown:function(){this.menuItems[this.currentHighlightedItem].main.color=this.unHighlightedColor;this.currentHighlightedItem==0?this.currentHighlightedItem=2:this.currentHighlightedItem==this.menuItems.length-1?this.currentHighlightedItem=0:this.currentHighlightedItem++;this.menuItems[this.currentHighlightedItem].main.color=this.highlightedColor},moveOneItemUp:function(){this.menuItems[this.currentHighlightedItem].main.color=this.unHighlightedColor;this.currentHighlightedItem==0?this.currentHighlightedItem=this.menuItems.length-1:this.currentHighlightedItem==2?this.currentHighlightedItem=0:this.currentHighlightedItem--;this.menuItems[this.currentHighlightedItem].main.color=this.highlightedColor}})});define("MenuScreen",["Screen","createjs","assetManager"],function(n,t,i){return n.extend({init:function(){this._super();var n=new t.Bitmap(i.images.bg);n.alpha=.4;this.mainView.addChild(n)}})});define("NpcEntity",["CreatureEntity","createjs","utils","text","tileManager","constants","assetManager"],function(n,t,i,r,u,f,e){return n.extend({init:function(n,t,i){this.mistakeWasMade=!1;this.isNpc=!0;this.placeInLine=-1;this._super(n,t,i);this.movementSpeed=Math.floor(Math.random()*(f.MAX_MOVEMENT_SPEED-f.MIN_MOVEMENT_SPEED))+f.MIN_MOVEMENT_SPEED;this.shouldMove=!1;this.movementDestination=null;this.timeSinceLastMove=0;this.isAggresive=Math.random()<f.CHANCE_OF_BEING_AGRESSIVE;this.numOfWarningsAfterLineCutting=0;this.killMode=!1;this.ignorePlayerWhenMoving=!1;this.ignoreNpcsWhenMoving=!1;this.playerIsBlockingMove=$.Callbacks();this.finishedMoving=$.Callbacks()},setItemCount:function(){this.initialItemCount=this.itemCount=Math.floor(Math.random()*3+3)},bump:function(){if(e.playSound("bump"),this.hit(),this.hitPoints===0){this.die();return}var n=i.getAbsolutePositionByGridPosition(this.row,this.col);this.randomShake(n,this,6);this.killMode||this.say(r.getRandomText(r.bumpTexts))},randomShake:function(n,r,u){var f=Math.round(Math.random()*u)-1,e=Math.round(Math.random()*u)-1;t.Tween.get(r.view).to({x:n.x+f,y:n.y+e},10,t.Ease.linear).call(function(){u>0&&(!r.shouldMove||r.timeSinceLastMove<r.movementSpeed)?r.randomShake(n,r,u-1):i.resetPosition(r)})},tick:function(n){if(this.shouldMove&&(this.checkForDestinationReached(),this.timeSinceLastMove+=n.delta,this.timeSinceLastMove>=this.movementSpeed)){var t=this.getNextPosition();(t.col!=this.col||t.row!==this.row)&&(this.setPosition(t.row,t.col),this.checkForDestinationReached(),this.moved.fire(this));this.timeSinceLastMove=0}},getNextPosition:function(){var n=this.col+Math.sign(this.movementDestination.col-this.col),t=this.row+Math.sign(this.movementDestination.row-this.row),i=this.checkForCollision(t,n);return i.bumpedPlayer?(t=this.row,n=this.col):i.collision&&(t!=this.row?(t=this.row,i=this.checkForCollision(t,n),i.collision&&(n=this.col)):n=this.col),{row:t,col:n}},checkForCollision:function(n,t){var r=!1,f=!1,i=u.collisionMap[n][t];return i&&(i.isPlayer?(r=!this.ignorePlayerWhenMoving,f=!this.ignorePlayerWhenMoving&&this.killMode&&this.bumpPlayer(i),this.playerIsBlockingMove.fire(this)):r=!i.isNpc||!this.ignoreNpcsWhenMoving),{collision:r,bumpedPlayer:f}},bumpPlayer:function(n){var r=this,u=i.getAbsolutePositionByGridPosition(this.row,this.col),f=Math.sign(n.view.x-this.view.x)*10+this.view.x,e=Math.sign(n.view.y-this.view.y)*10+this.view.y;return t.Tween.get(r.view).to({x:f,y:e},50,t.Ease.linear).call(function(){n.bump(r);t.Tween.get(r.view).to({x:u.x,y:u.y},50,t.Ease.linear)}),!0},checkForDestinationReached:function(){this.col===this.movementDestination.col&&this.row===this.movementDestination.row&&(this.shouldMove=!1,this.finishedMoving.fire(this))},kill:function(n){var t=this;this.killMode=!0;this.shouldMove=!0;this.movementDestination={row:n.row,col:n.col};this.itemCountLabel&&this.hideItemCount();n.moved.add(function(){t.movementDestination={row:n.row,col:n.col}})},die:function(){this.shouldMove=!1;this._super();this.speechBubble.alpha=0;this.itemCountLabel&&this.hideItemCount()}})});define("PlayerEntity",["createjs","CreatureEntity","text","constants","tileManager","assetManager","utils"],function(n,t,i,r,u,f,e){return t.extend({init:function(n,t){this._super(n,t,0);this.isPlayer=!0;this.hitPoints=3;this.winState=$.Callbacks();this.loseState=$.Callbacks()},createView:function(n,t){this._super(n,t);this.itemCountLabel.alpha=0},move:function(t,i){var o,s;if(!this.isDead)if(o=this.row+i,s=this.col+t,!u.collisionMap[o][s]&&o>=0&&o<r.NUM_ROWS&&s>=0&&s<r.NUM_COLUMNS)this.setPosition(o,s),f.playSound("walk"),this.moved.fire();else if(u.collisionMap[o][s]&&u.collisionMap[o][s].isNpc){var h=u.collisionMap[o][s],c=this,l=e.getAbsolutePositionByGridPosition(this.row,this.col),a=Math.sign(h.view.x-this.view.x)*10+this.view.x,v=Math.sign(h.view.y-this.view.y)*10+this.view.y;n.Tween.get(c.view).to({x:a,y:v},50,n.Ease.linear).call(function(){h.bump(c);n.Tween.get(c.view).to({x:l.x,y:l.y},50,n.Ease.linear)})}},removeItem:function(){this._super();this.itemCount===0&&this.winState.fire()},bump:function(n){f.playSound("bump");var t=this,r=e.getAbsolutePositionByGridPosition(this.row,this.col);this.randomShake(r,this,6);this.hit();this.hitPoints==0&&this.die(function(){var r;r=n.isCop?i.getRandomText(i.killedByCopTexts):n.isRobber?i.getRandomText(i.killedByRobberTexts):i.getRandomText(i.killedByNpcTexts);t.loseState.fire(r)})},randomShake:function(t,i,r){var u=Math.round(Math.random()*r)-1,f=Math.round(Math.random()*r)-1;n.Tween.get(i.view).to({x:t.x+u,y:t.y+f},10,n.Ease.linear).call(function(){r>0?i.randomShake(t,i,r-1):e.resetPosition(i)})}})});define("Queue",["createjs","NpcEntity","constants","utils","assetManager","CashierEntity","tileManager","text"],function(n,t,i,r,u,f,e,o){return Class.extend({init:function(t,i,o,s,h,c,l){var y=this,a,v;for(this.row=i,this.col=o,this.player=t,this.entryRow=c,this.exitRow=l,this.maxCreatures=s,this.minCreatures=h,this.npcsInQueue=[],this.allNpcs=[],this.mistakeDialogStarted=!1,this.isInEndgame=!1,this.pauseNpcs=!1,this.timeSinceLastScan=0,this.timeSinceLastNpcAddCheck=0,this.timeSinceLastCalledToMoveUp=-1,this.timeSinceLastWarnedAboutLineCutting=-1,this.cashier=new f(i-1,o+this.maxCreatures+1),this.cashier.died.add(function(){y.npcDied.fire()}),e.collisionMap[this.cashier.row][this.cashier.col]=this.cashier,this.table=new n.Bitmap(u.images.table),this.tablePosition={row:i,col:o+this.maxCreatures+1},this.firstInLinePosition={row:i,col:o+this.maxCreatures},a=r.getAbsolutePositionByGridPosition(this.tablePosition.row,this.tablePosition.col),this.table.x=a.x,this.table.y=a.y+6,this.table.scaleX=1.2,this.cashRegister=new n.Bitmap(u.images.cashRegister),this.cashRegister.x=a.x+2,this.cashRegister.y=a.y,this.currentItem=null,this.numOfCreatures=Math.round(Math.random()*(s-h)+h),v=0;v<this.numOfCreatures;v++)this.createNewNpc(this.row,o+this.maxCreatures-v);this.viewAdded=$.Callbacks();this.viewRemoved=$.Callbacks();this.npcDied=$.Callbacks();this.player.moved.add(function(){y.handlePlayerMove.apply(y)})},createNewNpc:function(n,i){var u=this,r=new t(n,i);return r.placeInLine=this.npcsInQueue.length,this.npcsInQueue.push(r),this.allNpcs.push(r),this.setNpcToAdvanceInQueue(r),r.playerIsBlockingMove.add(function(n){u.npcIsBlockedByPlayer.apply(u,[n])}),r.died.add(function(){u.npcsInQueue.splice(u.npcsInQueue.indexOf(r,1));u.allNpcs.splice(u.allNpcs.indexOf(r),1);u.npcDied.fire()}),r},getViews:function(){var n=[],t;for(n.push(this.cashier.view),n.push(this.table),n.push(this.cashRegister),this.currentItem&&n.push(this.currentItem),t=0;t<this.allNpcs.length;t++)n.push(this.allNpcs[t].view);return n},tick:function(n){var t,r;if(this.timeSinceLastCalledToMoveUp!==-1&&(this.timeSinceLastCalledToMoveUp+=n.delta,this.timeSinceLastCalledToMoveUp>i.TIME_BETWEEN_CALLS_TO_MOVE_UP&&(this.timeSinceLastCalledToMoveUp=-1)),this.timeSinceLastWarnedAboutLineCutting!==-1&&(this.timeSinceLastWarnedAboutLineCutting+=n.delta,this.timeSinceLastWarnedAboutLineCutting>i.TIME_BETWEEN_WARNINGS&&(this.timeSinceLastWarnedAboutLineCutting=-1)),!this.pauseNpcs)for(t=0;t<this.allNpcs.length;t++)this.allNpcs[t].tick(n);if(this.isInEndgame){this.cashier.tick(n);return}r=e.collisionMap[this.firstInLinePosition.row][this.firstInLinePosition.col];r&&!this.cashier.isDead&&(this.mistakeDialogStarted||(this.timeSinceLastScan+=n.delta,this.timeSinceLastScan>=this.cashier.timeToScan&&(this.timeSinceLastScan=0,this.scan(r))));this.npcsInQueue.length<i.MAX_CREATURES_IN_QUEUE&&(this.timeSinceLastNpcAddCheck+=n.delta,this.timeSinceLastNpcAddCheck>i.TIME_TO_MAYBE_ADD_NPC_TO_QUEUE&&(this.timeSinceLastNpcAddCheck=0,Math.random()>i.CHANCE_OF_NEW_NPC&&this.addNewNpc()))},scan:function(n){if(this.currentItem&&this.viewRemoved.fire(this.currentItem),n.itemCount>0){n.removeItem();this.currentItem=this.getRandomItem();var t=r.getAbsolutePositionByGridPosition(this.row,this.col+this.maxCreatures+1);this.currentItem.x=t.x+27;this.currentItem.y=t.y+9;this.viewAdded.fire(this.currentItem);u.playSound("beep",.1)}else n.isNpc&&(!n.mistakeWasMade&&Math.random()*10>this.cashier.accuracy?this.startMistakeDialog(n):(n.hideItemCount(),this.leave(n)))},startMistakeDialog:function(n){this.mistakeDialogStarted=!0;var t=this;n.mistakeWasMade=!0;n.say(o.getRandomText(o.mistakeTexts),3e3,function(){this.isInEndgame||t.cashier.say(o.getRandomText(o.cashierMistakeTexts),3e3,function(){n.itemCount=n.initialItemCount;t.mistakeDialogStarted=!1},2e3)},2e3)},getRandomItem:function(){var t=Math.random()*129,i={images:[u.images.items],frames:{width:16,height:16},animations:{idle:{frames:[t],speed:0}}},r=new n.SpriteSheet(i);return new n.Sprite(r,"idle")},setNpcToAdvanceInQueue:function(n){n.movementDestination={row:this.tablePosition.row,col:this.tablePosition.col-1};n.shouldMove=!0},leave:function(n){var r,u,t;n.placeInLine=-1;this.moveUpInLine();this.npcsInQueue.splice(0,1);n.shouldMove=!0;r=this.exitRow;u=i.NUM_COLUMNS;n.movementDestination={row:r,col:u};t=this;n.finishedMoving.add(function(){t.viewRemoved.fire(this.view);e.collisionMap[n.row][n.col]=!1;t.allNpcs.splice(t.allNpcs.indexOf(n),1);n=null})},moveUpInLine:function(){for(var n=0;n<this.npcsInQueue.length;n++)this.npcsInQueue[n].placeInLine--},addNewNpc:function(){if(!e.collisionMap[this.entryRow][0]){var n=this.createNewNpc(this.entryRow,0);this.viewAdded.fire(n.view)}},handlePlayerMove:function(){var n,t;if(!this.isInEndgame){if(this.player.row===this.row){if(this.npcsInQueue.length>1&&this.npcsInQueue[this.npcsInQueue.length-1].col<this.player.col&&this.player.col<this.tablePosition.col&&!this.playerInQueue){for(n=null,t=0;t<this.npcsInQueue.length;t++)this.npcsInQueue[t].col<this.player.col&&(n=n?this.player.col-this.npcsInQueue[t].col<this.player.col-n.col?this.npcsInQueue[t]:n:this.npcsInQueue[t]);n&&(n.placeInLine===this.npcsInQueue.length-1&&this.player.col-n.col>1?n.say(o.getRandomText(o.notQuiteCutInLineTexts)):(n.say(o.getRandomText(o.cutInLineTexts),1500),this.playerCutInLine=!0,this.timeSinceLastWarnedAboutLineCutting=0))}}else this.playerCutInLine=!1;this.playerInQueue=this.player.row===this.row}},npcIsBlockedByPlayer:function(n){this.isInEndgame||(this.timeSinceLastCalledToMoveUp===-1&&(!this.playerCutInLine&&!e.collisionMap[this.row][this.player.col+1]&&this.player.col<this.tablePosition.col-1&&n.say(o.getRandomText(o.playerHoldingUpLine)),this.timeSinceLastCalledToMoveUp=0),this.timeSinceLastWarnedAboutLineCutting===-1&&(this.playerCutInLine&&(n.numOfWarningsAfterLineCutting<i.NUM_OF_WARNINGS_BEFORE_ENGAGING?(n.say(o.getRandomText(o.warnAfterLineCutting),1500),n.numOfWarningsAfterLineCutting++):n.isAggresive&&n.kill(this.player)),this.timeSinceLastWarnedAboutLineCutting=0))}})});define("RobberEntity",["createjs","CreatureEntity","text","constants","assetManager","NpcEntity"],function(n,t,i,r,u,f){return f.extend({init:function(){this._super(5,14);this.hitPoints=9;this.isRobber=!0},createSpriteSheet:function(){var t=Math.random()*.04+.06,i={images:[u.images.robber],frames:{width:this.size.w,height:this.size.h},animations:{idle:{frames:[0,1],speed:t}}};this.spriteSheet=new n.SpriteSheet(i)},createView:function(t,i){this.view=new n.Container;this.createSpeechBubble(r.TILE_SIZE*2,r.TILE_SIZE*2,-r.TILE_SIZE/2,"13px",15);this.avatar=new n.Sprite(this.spriteSheet,"idle");this.avatar.regX=this.avatar.regY=this.size.w/2;this.avatar.x=this.avatar.y=this.size.w/2;this.view.addChild(this.avatar);this.view.x=t;this.view.y=i},say:function(n,t,i){this._super(n,t||5e3,i,!0)}})});define("Screen",["createjs","constants"],function(n,t){return Class.extend({init:function(){this.mainView=new n.Container;this.mainView.alpha=0;this.goToMainMenuScreen=$.Callbacks();this.goToGameScreen=$.Callbacks();this.goToCreditsScreen=$.Callbacks();this.goToInstructionsScreen=$.Callbacks();this.highlightedColor="Khaki";this.unHighlightedColor="white"},handleKeyDown:function(){},handleKeyUp:function(){},activate:function(){},tick:function(){},show:function(t){n.Tween.get(this.mainView).to({alpha:1},300,n.Ease.quadIn).call(function(){t&&t()})},hide:function(t){n.Tween.get(this.mainView).to({alpha:0},300,n.Ease.quadIn).call(function(){t&&t()})},createOutlinedText:function(i,r,u,f,e,o){var c=new n.Text(i,r+"px "+t.FONT+"",e||"white"),h,s,l;return c.textAlign="center",c.textBaseline="middle",c.x=t.WORLD_WIDTH/2,c.y=0,h=new n.Text(i,r+"px "+t.FONT+"",o||"gray"),h.textAlign="center",h.textBaseline="middle",h.x=t.WORLD_WIDTH/2+f,h.y=f,s=new n.Container,s.x=0,s.y=u,s.setBounds(0,u,t.WORLD_WIDTH,r),s.addChild(h,c),s.main=c,s.outline=h,s.regY=r/2,s.setText=function(n){this.main.text=n;this.outline.text=n},s.setLineWidth=function(n){this.main.lineWidth=n;this.outline.lineWidth=n},s.setLineHeight=function(n){this.main.lineHeight=n;this.outline.lineHeight=n},l=new n.Shape,l.graphics.beginFill("#000").drawRect(0,-3,t.WORLD_WIDTH,r+6),s.hitArea=l,s}})});define("screenManager",["createjs","GameScreen","MainMenuScreen","CreditsScreen","InstructionsScreen","SplashScreen"],function(n,t,i,r,u,f){var e=[],o,s,h=function(n){s=new f(n)},c=function(){e.push(new i);e.push(new t);e.push(new r);e.push(new u);o=e[0];var n=this;e[0].goToGameScreen.add(function(){n.goToScreen(1)});e[0].goToCreditsScreen.add(function(){n.goToScreen(2)});e[0].goToInstructionsScreen.add(function(){n.goToScreen(3)});e[1].goToMainMenuScreen.add(function(){n.goToScreen(0)});e[2].goToMainMenuScreen.add(function(){n.goToScreen(0)});e[3].goToMainMenuScreen.add(function(){n.goToScreen(0)})},l=function(n){o.hide(function(){o=e[n];o.show(function(){o.activate()})})};return{init:c,screens:e,gameScreen:function(){return e[1]},getCurrentScreen:function(){return o},goToScreen:l,loadSplash:h,splashScreen:function(){return s}}});define("SplashScreen",["Screen","assetManager","createjs"],function(n,t,i){return n.extend({init:function(n){var r=this;this._super();this.logo=new i.Bitmap("/content/images/logo.png");this.logo.y=80;this.logo.x=230;this.mainView.addChild(this.logo);this.progressLabel=this.createOutlinedText("0%",36,340,4);this.mainView.addChild(this.progressLabel);t.loadAssets();t.progressChangedEvent.add(function(n){r.progressLabel.setText(Math.floor(n*100)+"%")});t.loadCompleteEvent.add(function(){r.hide(function(){n()})});this.show()}})});define("text",[],function(){var n={cashier:{first:["Shelby","Patsy","Lou Ann","Ginny","Mae","Trina","Winona","Naomi","Shirleen","Bitsy","Doreen","Tanya","Tammy","Lurleen","Peggy","Pearl","Billie","Betty","Opal","Cheyenne","Angel","Loretta","Condoleeza","Sadie","Twyla","Rhonda","Crystal"],last:["Ann","Lou","Lee","Kay","Marie","Lynn","Jo","Mae","April","Sue"]},npc:[]},t=function(t){for(var i="";!i||i.length>t;)if(i=n.cashier.first[Math.floor(Math.random()*n.cashier.first.length)]+" "+n.cashier.last[Math.floor(Math.random()*n.cashier.last.length)],!t)break;return i},i=function(n,t){return t>=n.length?n[n.length-1]:n[t]},r=function(n){return n[Math.floor(Math.random()*n.length)]};return{checkedOutFastTexts:["Plenty of time to drink some potions with the guys before heading off to the dungeon","You'll get first pick of the princesses","Early bird gets the best loot","A winner is you","Boomshakalaka!"],checkedOutSlowTexts:["You won't have enough time to pick up your belt of dexterity +1 from the tailor","You'll have to skip picking up your gauntlets from dry cleaning","Any slower and you'll check out tomorrow","Did you stop to smell the potions?","There's no cake!","Stay awhile... Stay FOREVER"],checkedOutMiddleTexts:["Enough time to oil the sword, but not the armor","Stayed a while, and listened?","Took you a while, but you got there"],killedByNpcTexts:["Cutting in line can be dangerous!","What goes around comes around!","You have died of line cuttery",],checkedOutTexts:["Checked out!","Done and done!","A job well done!"],killedByCopTexts:["Crime doesn't (always) pay!","You can't hide from the long arm of the law!","Try not to take an arrow to the knee!","Guards are not invincible!"],killedByRobberTexts:["Be quick or be dead!","Don't listen to him, be a hero!","With great power comes great responsibility!"],getCashierName:t,mistakeTexts:["I think you made mistake","No way this costs 10 gold","Did you scan my coupons?","It should be '2 for 1' on the picklocks"],getRandomText:r,bumpTexts:["Hey!","Watch it!","I'm walking here! I'm walking here!","Have you heard of personal space!?","Step back buddy!","You wanna go outside?!","Do that one more time, I dare you","Well excuse you!","What's your problem man?!","Sorry didn't mean to get in your way","Please don't hurt me","Watch it my dad is level 30","Watch where you're walking grandpa","Am I in a 'The Verve' video clip?"],cutInLineTexts:["Line cutter!","Not fair mate!","Back of the line!","Who do you think you are?!","Cut the line and I'll cut you!","Oh no you didn't","It's ok, none of us are in a rush","Go ahead sir fancy pants","Walking right through? Lah-di-da","Ohhhhh, goooood for you"],notQuiteCutInLineTexts:["I'll let this one slide","Sneaky bastard","Think you're clever","Bad karma for you","Beat me to it","So close!","Frankly, my dear, I give a damn","Objection!"],playerHoldingUpLine:["Move up pal!","Wake up!","We're gonna be here all day","Take your time buddy","HELLO","Anybody home mcfly?!","No rush, I like waiting in line","Don't mind me I've got all day","Move it along Sunday driver","Speed it up slowpoke",],warnAfterLineCutting:["I'm warning you!","Last warning!","Step out now friend!","Last chance to leave with your teeth","You won't like me when I'm angry","Let me introduce you to my little friend","The gloves are coming off","No more mister nice guy","Just give me an excuse dude","You wanna keep that pretty face?","We're done professionally","Are you f****** SORRY!","Have you thought about your last words?","let me introduce you to the floor","Go ahead, make my day","Would you kindly step out of the way?"],robber:{enterTexts:["Nobody move! This is a stick-up!","What's the line again? oh yeah, stick-up!"],afterEveryoneLeaves:[['Did they not hear me say "nobody move?"',"ANYWAY","The money in the bag, NOW!"],["Yeah yeah run away","Well","You know what to do - money -> bag"]],provoked:[["I said DON'T MOVE","Don't be a hero","Let's do this!"],["You again?","This didn't turn out well for you last time","Here we go!"]]},getRobberText:i,cashierEndTexts:["You saved us!","(Like you had a choice)","We would like to thank you, and give you","Free deliveries for life!","You will never have to stand in line AGAIN!"],cashierMistakeTexts:["Sorry, I'll have to do it again sir","I'll do it again right now"]}});define("tileManager",["createjs","assetManager","constants"],function(n,t,i){var u,e=function(){for(var o,t,n,e=0;e<i.NUM_ROWS;e++){for(o=[],n=0;n<i.NUM_COLUMNS;n++)o.push(!1);r.push(o)}for(t=window.tilemap,n=0;n<t.layers.length;n++)if(t.layers[n].name=="Collision"){u=t.layers[n];break}f()},r=[],f=function(){for(var t,f,n=0;n<i.NUM_ROWS;n++)for(t=0;t<i.NUM_COLUMNS;t++)f=n*i.NUM_COLUMNS+t,r[n][t]=u.data[f]==1};return e(),{collisionMap:r,clearCollisionMap:f}});define("utils",["createjs","constants"],function(n,t){var i=function(n,i){return{x:i*t.TILE_SIZE,y:n*t.TILE_SIZE}},r=function(n){var t=i(n.row,n.col);n.view.x=t.x;n.view.y=t.y},u=function(n){var r=n/1e3,t=Math.floor(r/60),i=Math.floor(r-t*60);return(t==0?"00":t<10?"0"+t.toString():t)+":"+(i==0?"00":i<10?"0"+i.toString():i)},f=function(n){var u=n/1e3,i=Math.floor(u/60),r=Math.floor(u-i*60),t="";return i>0&&(t=i+" minutes ",r>0&&(t+="and ")),r>0&&(t+=r+" seconds"),t};return{getTimespanInText:f,getAbsolutePositionByGridPosition:i,resetPosition:r,msToReadableTime:u}});
